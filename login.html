<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>LexAi ‚Äì Log in</title>

<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
:root{ --brand-green:#00c2b5; --brand-teal:#00bfc7; --footer-bg:#0b0d19 }
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:'Poppins',sans-serif;background:#f4f6f8;color:#0b0d19;
     display:flex;flex-direction:column;min-height:100vh}
main{flex:1;display:flex;align-items:center;justify-content:center;padding:90px 1rem}

/* navbar / card / footer same as in signup  */
.glass{position:fixed;top:0;left:0;width:100%;z-index:999;
  display:flex;justify-content:space-between;align-items:center;
  padding:.8rem 4vw;background:rgba(255,255,255,.35);backdrop-filter:blur(18px)}
.brand{font:700 1.4rem/1 'Poppins';color:var(--brand-green);text-decoration:none}
.nav-links{list-style:none;display:flex;gap:2.4rem}
.nav-item{color:#000;text-decoration:none;font-weight:500;transition:color .2s}
.nav-item:hover{color:var(--brand-teal)}
.btn-cta{background:var(--brand-green);color:#fff;padding:.5rem 1.4rem;
  border-radius:25px;font-weight:600;font-size:.9rem;text-decoration:none}

.card{width:100%;max-width:420px;background:#fff;border-radius:14px;
  padding:2.5rem 2.2rem;box-shadow:0 6px 18px rgba(0,0,0,.08);text-align:center}
.card h2{font-size:1.6rem;font-weight:700;margin-bottom:.4rem}
.card p.sub{font-size:.95rem;color:#566}
input{width:100%;padding:.75rem 1rem;border:2px solid #e5e7eb;border-radius:8px;
  font-size:.95rem;margin-top:1.2rem}
.pw-wrap{position:relative}
.pw-toggle{position:absolute;right:12px;top:50%;transform:translateY(-50%);
  font-size:1rem;cursor:pointer;border:none;background:none;color:#777}
button.primary{width:100%;padding:.8rem 0;margin-top:1.6rem;border:none;border-radius:25px;
  font-weight:600;font-size:1rem;color:#fff;background:var(--brand-green);
  cursor:pointer;transition:box-shadow .18s,transform .18s}
button.primary:hover{transform:translateY(-2px);box-shadow:0 8px 18px rgba(0,0,0,.15)}
.card small a{color:var(--brand-teal);text-decoration:none;font-weight:600}
.card small{display:block;margin-top:1.2rem}
.site-footer{background:var(--footer-bg);color:#d1d1d1;padding:2rem;text-align:center;font-size:.9rem}

/* modal same as before */
.lex-modal{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;
  background:rgba(0,0,0,.45);backdrop-filter:blur(2px);z-index:10000;display:none}
.lex-box{background:#fff;border-radius:16px;padding:1.8rem 2.2rem;max-width:340px;
  text-align:center;box-shadow:0 8px 24px rgba(0,0,0,.15)}
.lex-box h4{font-size:1.25rem;margin-bottom:1rem;color:var(--brand-green)}
.lex-box button{margin-top:1rem;padding:.55rem 1.4rem;border:none;border-radius:45px;
  background:var(--brand-green);color:#fff;font-weight:600;cursor:pointer}

#pwResetModal .lex-box input{
  border:2px solid #e5e7eb;border-radius:8px;
}
</style>
</head>
<body>

<nav class="glass">
  <a href="index.html" class="brand">LexAi</a>
  <ul class="nav-links">
    <li><a href="index.html" class="nav-item">Home</a></li>
    <li><a href="#" class="nav-item">Features</a></li>
    <li><a href="about.html" class="nav-item">About</a></li>
  </ul>
  <a href="signup.html" class="btn-cta">Sign up</a>
</nav>

<main>
  <form id="loginForm" class="card">
    <h2>Welcome back</h2>
    <p class="sub">Log in to continue.</p>

    <input id="email" type="email" placeholder="Email address" required>

    <div class="pw-wrap">
      <input id="pw" type="password" placeholder="Password" required>
      <button type="button" class="pw-toggle" onclick="togglePw('pw',this)">üëÅÔ∏è</button>
    </div>

    <button type="submit" class="primary">Log in</button>
    <small>Don‚Äôt have an account? <a href="signup.html">Sign up</a></small>
    <small style="display:block;margin-top:1rem">
    <a href="#" id="pwLostLink">Forgot password?</a>
    </small>
  </form>
</main>

<footer class="site-footer">
  ¬© 2025 LexAi ‚Äì All rights reserved
</footer>

<!-- mini modal -->
<div id="lexModal" class="lex-modal">
  <div class="lex-box">
    <h4>LexAi says</h4>
    <p id="lexMsg"></p>
    <button onclick="lexClose()">OK</button>
  </div>
</div>

<script>
const backendUrl = "https://api.lexai.work";         

/* ---------- tiny modal helpers -------------------------- */
function lexAlert(msg){
  document.getElementById("lexMsg").textContent = msg;
  document.getElementById("lexModal").style.display = "flex";
}
function lexClose(){ document.getElementById("lexModal").style.display="none";}

/* ---------- show / hide password ------------------------ */
function togglePw(id,btn){
  const f = document.getElementById(id);
  const hid = f.type === "password";
  f.type = hid ? "text" : "password";
  btn.textContent = hid ? "üëÅÔ∏è" : "üö´";
}

/* quick helper */
const isEmail = e => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e);

/* ---------- submit handler ------------------------------ */
document.getElementById("loginForm").onsubmit = async e=>{
  e.preventDefault();

  const email = document.getElementById("email").value.trim();
  const pwd   = document.getElementById("pw").value;

  if(!isEmail(email)) return lexAlert("Enter a valid e-mail.");
  if(!pwd)            return lexAlert("Password required.");

  /*  build x-www-form-urlencoded payload  */
  const body = new URLSearchParams({
    grant_type : "password",            // required but may be blank
    username   : email,
    password   : pwd,
    scope      : "",
    client_id  : "",
    client_secret: ""
  });
     
  document.getElementById("loginSpin").style.display="flex";
  
     try{
    const r = await fetch(`${backendUrl}/login`,{
      method : "POST",
      headers: { "Content-Type":"application/x-www-form-urlencoded" },
      body   : body.toString()
    });

    if(!r.ok){
      return lexAlert("Incorrect e-mail or password.");
    }

    const {access_token} = await r.json();
    /* persist & go to app ------------------------------------------------ */
    localStorage.setItem("lexai_token", access_token);
    location.href = "trans.html";

  }catch{ 
    lexAlert("Backend unreachable."); 
  }finally{
    document.getElementById("loginSpin").style.display="none";
}
};
</script>
<script>
/* ---------- PW-RESET flow ------------------------------------ */
const m = id => document.getElementById(id);

function closePwReset(){ m("pwResetModal").style.display="none"; }

document.getElementById("pwLostLink").onclick = e=>{
  e.preventDefault();
  m("pwStep1").style.display = "";
  m("pwStep2").style.display = "none";
  m("pwResetEmail").value = "";
  m("pwResetModal").style.display = "flex";
};

/* STEP 1 ‚Äì request code */
async function sendReset(){
  const email = m("pwResetEmail").value.trim();
  if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email))
      return lexAlert("Enter a valid e-mail.");

  await fetch(`${backendUrl}/pw-reset/request`,{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({email})
  });

  await lexAlert("If this address exists, a code has been sent.");
  m("pwStep1").style.display = "none";
  m("pwStep2").style.display = "";
}

/* STEP 2 ‚Äì confirm code + new pw */
async function confirmReset(){
  const code = m("pwCode").value.trim();
  const pw   = m("pwNew").value.trim();
  if(code.length < 4 || pw.length < 6)
      return lexAlert("Fill both fields (‚â•6-char password).");

  const r = await fetch(`${backendUrl}/pw-reset/confirm`,{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({code,new_password:pw})
  });

  if(r.ok){
    lexAlert("Password updated ‚Äî you can log in now.");
    closePwReset();
  }else{
    lexAlert("Invalid or expired code.");
  }
}
</script>
<div id="loginSpin" style="
      display:none;position:fixed;inset:0;z-index:9999;
      background:rgba(255,255,255,.6);backdrop-filter:blur(2px);
      align-items:center;justify-content:center;font:600 1rem Poppins">
  Signing in ‚Ä¶
</div>
<!-- === tiny ‚Äúreset password‚Äù modal =============================== -->
<div id="pwResetModal" class="lex-modal" style="display:none">
  <div class="lex-box" style="max-width:340px">
    <h4>Reset password</h4>

    <!-- step 1: ask for e-mail -->
    <p id="pwStep1">
      Enter your account e-mail ‚Äì we‚Äôll send a 6-digit code.
      <input id="pwResetEmail" type="email"
             style="margin-top:.9rem;width:100%;padding:.6rem">
      <button onclick="sendReset()" style="margin-top:1rem">Send&nbsp;code</button>
    </p>

    <!-- step 2: code + new pw -->
    <div id="pwStep2" style="display:none">
      <input id="pwCode" placeholder="Code"
             style="width:100%;padding:.6rem;margin-top:.8rem">
      <input id="pwNew" type="password" placeholder="New password (6+ chars)"
             style="width:100%;padding:.6rem;margin-top:.8rem">
      <button onclick="confirmReset()" style="margin-top:1rem">Update</button>
    </div>

    <button onclick="closePwReset()" style="margin-top:1.2rem">Close</button>
  </div>
</div>
</body>
</html>
